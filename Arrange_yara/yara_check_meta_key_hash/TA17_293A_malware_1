rule TA17_293A_malware_1 {
  meta:
    author = "Spider"
    comment = "None"
    date = "2017/07/17"
    description = "inveigh pen testing tools & related artifacts"
    family = "None"
    hacker = "None"
    hash0 = "61C909D2F625223DB2FB858BBDF42A76"
    hash1 = "A07AA521E7CAFB360294E56969EDA5D6"
    hash10 = "4595DBE00A538DF127E0079294C87DA0"
    hash2 = "BA756DD64C1147515BA2298B6A760260"
    hash3 = "8943E71A8C73B5E343AA9D2E19002373"
    hash4 = "04738CA02F59A5CD394998A99FCD9613"
    hash5 = "038A97B4E2F37F34B255F0643E49FC9D"
    hash6 = "65A1A73253F04354886F375B59550B46"
    hash7 = "AA905A3508D9309A93AD5C0EC26EBC9B"
    hash8 = "5DBEF7BDDAF50624E840CCBCE2816594"
    hash9 = "722154A36F32BA10E98020A8AD758A7A"
    judge = "unknown"
    reference = "https://www.us-cert.gov/ncas/alerts/TA17-293A"
    threatname = "None"
    threattype = "None"
  strings:
    $n1 = "file://"
    $ax1 = "184.154.150.66"
    $ax2 = "5.153.58.45"
    $ax3 = "62.8.193.206"
    $ax4 = "/pshare1/icon"
    $ax5 = "/ame_icon.png"
    $ax6 = "/1/ree_stat/p"
    /* Too many false positives with these strings
    $au1 = "/icon.png"
    $au2 = "/notepad.png"
    $au3 = "/pic.png"
    $s1 = "(g.charCodeAt(c)^l[(l[b]+l[e])%256])"
    $s2 = "for(b=0;256>b;b++)k[b]=b;for(b=0;256>b;b++)"
    $s3 = "VXNESWJfSjY3grKEkEkRuZeSvkE="
    $s4 = "NlZzSZk="
    $s5 = "WlJTb1q5kaxqZaRnser3sw=="
    $x1 = { 87 d0 81 f6 0c 67 f5 08 6a 00 33 15 d4 9a 40 00 f7 d6 e8 eb 12 00 00 81 f7 f0 1b dd 21 f7 de }
    $x2 = { 33 c4 2b cb 33 3d c0 ad 40 00 43 c1 c6 1a 33 c3 f7 de 33 f0 42 c7 05 b5 ac 40 00 26 af 21 02 }
    $x3 = "fromCharCode(d.charCodeAt(e)^k[(k[b]+k[h])%256])"
    $x4 = "ps.exe -accepteula \\%ws% -u %user% -p %pass% -s cmd /c netstat"
    $x5 = { 22 54 6f 6b 65 6e 73 3d 31 20 64 65 6c 69 6d 73 3d 5c 5c 22 20 25 25 49 20 49 4e 20 28 6c 69 73 74 2e 74 78 74 29 }
    $x6 = { 68 65 6c 6c 2e 65 78 65 20 2d 6e 6f 65 78 69 74 20 2d 65 78 65 63 75 74 69 6f 6e 70 6f 6c 69 63 79 20 62 79 70 61 73 73 20 2d 63 6f 6d 6d 61 6e 64 20 22 2e 20 2e 5c 49 6e 76 65 69 67 68 2e 70 }
    $x7 = { 47 6f 20 62 75 69 6c 64 20 49 44 3a 20 22 66 62 64 33 37 39 37 62 31 63 31 34 65 30 65 31 }
    $x8 = { 24 69 6e 76 65 69 67 68 2e 73 74 61 74 75 73 5f 71 75 65 75 65 2e 41 64 64 28 22 50 72 65 73 73 20 61 6e 79 20 6b 65 79 20 74 6f 20 73 74 6f 70 20 72 65 61 6c 20 74 69 6d 65 }
    $x9 = { 2f 73 65 74 74 69 6e 67 73 2e 78 6d 6c b4 56 61 6f db 36 13 fe fe 02 ef 7f 10 f4 79 8e 64 c5 4d 06 a1 4e d1 25 f1 9a 22 5e 87 c9 fd 01 94 48 5b }
    $x10 = { 6c 73 2f 73 65 74 74 69 6e 67 73 2e 78 6d 6c 2e 72 65 6c 73 55 54 05 00 01 00 76 a4 12 75 78 0b 00 01 04 00 00 00 00 04 00 00 00 00 8d 90 b9 4e 03 31 10 86 eb f0 14 d6 f4 d8 7b 48 21 44 71 d2 }
    $x11 = { 8d 90 b9 4e 03 31 10 86 eb f0 14 d6 f4 d8 7b 48 21 44 71 d2 10 a4 14 50 a0 e5 01 46 eb d9 43 f8 92 3d 41 c9 db e3 a5 4a 24 0a ca 39 4a 24 0a ca 39 }
    $x12 = { 8c 90 cd 4e eb 30 10 85 d7 bd 4f 61 cd fe da 09 21 50 a1 ba dd 00 52 17 b0 40 e1 01 46 f1 24 b1 f0 9f ec 01 b5 6f 8f c3 aa 95 58 b0 b4 }
    $x13 = { 8c 90 cd 4e eb 30 10 85 d7 bd 4f 61 cd fe da 09 21 50 a1 ba dd 00 52 17 b0 40 e1 01 46 f1 24 b1 f0 9f ec 01 b5 6f 8f c3 aa 95 58 b0 b4 }
    $x14 = "http://bit.ly/2m0x8IH"
  condition:
    ( $n1 and 1 of ($ax*) ) or
    2 of ($s*) or
    1 of ($x*)
}