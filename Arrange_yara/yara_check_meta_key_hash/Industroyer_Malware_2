rule Industroyer_Malware_2 {
  meta:
    author = "Spider"
    comment = "None"
    date = "2017-06-13"
    description = "Detects Industroyer related malware"
    family = "None"
    hacker = "None"
    hash1 = "3e3ab9674142dec46ce389e9e759b6484e847f5c1e1fc682fc638fc837c13571"
    hash1 = "6d707e647427f1ff4a7a9420188a8831f433ad8c5325dc8b8cc6fc5e7f1f6f47"
    hash2 = "37d54e3d5e8b838f366b9c202f75fa264611a12444e62ae759c31a0d041aa6e4"
    hash3 = "ecaf150e087ddff0ec6463c92f7f6cca23cc4fd30fe34c10b3cb7c2a6d135c77"
    judge = "unknown"
    license = "https://creativecommons.org/licenses/by-nc/4.0/"
    reference = "https://goo.gl/x81cSy"
    threatname = "None"
    threattype = "None"
  strings:
    $x1 = "sc create %ls type= own start= auto error= ignore binpath= \"%ls\" displayname= \"%ls\"" fullword wide
    $x2 = "10.15.1.69:3128" fullword wide
    $s1 = "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; InfoPath.1)" fullword wide
    $s2 = "/c sc stop %s" fullword wide
    $s3 = "sc start %ls" fullword wide
    $s4 = "93.115.27.57" fullword wide
    $s5 = "5.39.218.152" fullword wide
    $s6 = "tierexe" fullword wide
    $s7 = "comsys" fullword wide
    $s8 = "195.16.88.6" fullword wide
    $s9 = "TieringService" fullword wide
    $a1 = "TEMP\x00\x00DEF" fullword wide
    $a2 = "TEMP\x00\x00DEF-C" fullword wide
    $a3 = "TEMP\x00\x00DEF-WS" fullword wide
    $a4 = "TEMP\x00\x00DEF-EP" fullword wide
    $a5 = "TEMP\x00\x00DC-2-TEMP" fullword wide
    $a6 = "TEMP\x00\x00DC-2" fullword wide
    $a7 = "TEMP\x00\x00CES-McA-TEMP" fullword wide
    $a8 = "TEMP\x00\x00SRV_WSUS" fullword wide
    $a9 = "TEMP\x00\x00SRV_DC-2" fullword wide
    $a10 = "TEMP\x00\x00SCE-WSUS01" fullword wide
  condition:
    ( uint16(0) == 0x5a4d and filesize < 300KB and 1 of ($x*) or 3 of them or 1 of ($a*) ) or ( 5 of them )
}