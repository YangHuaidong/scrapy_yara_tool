import "pe"

rule Silence_malware_2 {
  meta:
    author = "Spider"
    comment = "None"
    date = "2017-11-01"
    description = "Detects malware sample mentioned in the Silence report on Securelist"
    family = "None"
    hacker = "None"
    hash1 = "75b8f534b2f56f183465ba2b63cfc80b7d7d1d155697af141447ec7144c2ba27"
    judge = "unknown"
    license = "https://creativecommons.org/licenses/by-nc/4.0/"
    reference = "https://securelist.com/the-silence/83009/"
    threatname = "None"
    threattype = "None"
  strings:
    $x1 = "\\ScreenMonitorService\\Release\\smmsrv.pdb" ascii
    $x2 = "\\\\.\\pipe\\{73F7975A-A4A2-4AB6-9121-AECAE68AABBB}" fullword ascii
    $s1 = "My Sample Service: ServiceMain: SetServiceStatus returned error" fullword ascii
    $s2 = "\\mss.exe" fullword ascii
    $s3 = "\\out.dat" fullword ascii
    $s4 = "\\mss.txt" fullword ascii
    $s5 = "Default monitor" fullword ascii
  condition:
    ( uint16(0) == 0x5a4d and filesize < 600KB and (
    pe.imphash() == "69f3ec173efb6fd3ab5f79e0f8051335" or
    ( 1 of ($x*) or 3 of them )
    ) or ( 5 of them )
}