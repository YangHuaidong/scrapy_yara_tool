rule OpCloudHopper_Malware_3 {
  meta:
    author = "Spider"
    comment = "None"
    date = "2017-04-03"
    description = "Detects malware from Operation Cloud Hopper"
    family = "None"
    hacker = "None"
    hash1 = "c21eaadf9ffc62ca4673e27e06c16447f103c0cf7acd8db6ac5c8bd17805e39d"
    judge = "black"
    license = "https://creativecommons.org/licenses/by-nc/4.0/"
    reference = "https://www.pwc.co.uk/issues/cyber-security-data-privacy/insights/operation-cloud-hopper.html"
    threatname = "None"
    threattype = "None"
  strings:
    $s6 = "operator \"\" " fullword ascii
    $s7 = "zok]\\\\\\ZZYYY666564444" fullword ascii
    $s11 = "InvokeMainViaCRT" fullword ascii
    $s12 = ".?AVAES@@" fullword ascii
    $op1 = { b6 4c 06 f5 32 cf 88 4c 06 05 0f b6 4c 06 f9 32 }
    $op2 = { 06 fc eb 03 8a 5e f0 85 c0 74 05 8a 0c 06 eb 03 }
    $op3 = { 7e f8 85 c0 74 06 8a 74 06 08 eb 03 8a 76 fc 85 }
  condition:
    ( uint16(0) == 0x5a4d and filesize < 600KB and ( all of ($s*) and 1 of ($op*) ) or all of ($op*) ) or ( 5 of them )
}