rule ZxShell_Related_Malware_CN_Group_Jul17_1 {
  meta:
    author = "Spider"
    comment = "None"
    date = "2017-07-08"
    description = "Detects a ZxShell related sample from a CN threat group"
    family = "None"
    hacker = "None"
    hash1 = "ef56c2609bc1b90f3e04745890235e6052a4be94e35e38b6f69b64fb17a7064e"
    judge = "black"
    license = "https://creativecommons.org/licenses/by-nc/4.0/"
    reference = "https://blogs.rsa.com/cat-phishing/"
    threatname = "None"
    threattype = "None"
  strings:
    $x1 = "CMD.EXE /C NET USER GUEST /ACTIVE:yes && NET USER GUEST ++++++" ascii
    $x2 = "system\\cURRENTcONTROLSET\\sERVICES\\tERMSERVICE" fullword ascii
    $x3 = "\\secivreS\\teSlortnoCtnerruC\\METSYS" fullword ascii /* reversed goodware string 'SYSTEM\\CurrentControlSet\\Services\\' */
    $x4 = "system\\cURRENTCONTROLSET\\cONTROL\\tERMINAL sERVER" fullword ascii
    $x5 = "sOFTWARE\\mICROSOFT\\iNTERNET eXPLORER\\mAIN" fullword ascii
    $x6 = "eNABLEaDMINtsREMOTE" fullword ascii
  condition:
    ( uint16(0) == 0x5a4d and filesize < 400KB and 1 of them )
}