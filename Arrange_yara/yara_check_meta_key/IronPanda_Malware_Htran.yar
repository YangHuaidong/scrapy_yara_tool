rule IronPanda_Malware_Htran {
  meta:
    author = "Spider"
    comment = "None"
    date = "2015-09-16"
    description = "Iron Panda Malware Htran"
    family = "None"
    hacker = "None"
    hash = "7903f94730a8508e9b272b3b56899b49736740cea5037ea7dbb4e690bcaf00e7"
    judge = "black"
    license = "https://creativecommons.org/licenses/by-nc/4.0/"
    reference = "https://goo.gl/E4qia9"
    threatname = "None"
    threattype = "None"
  strings:
    $s1 = "[-] Gethostbyname(%s) error:%s" fullword ascii
    $s2 = "%s -<listen|tran|slave> <option> [-log logfile]" fullword ascii
    $s3 = "-slave <ConnectHost> <ConnectPort> <TransmitHost> <TransmitPort>" fullword ascii
    $s4 = "[-] ERROR: Must supply logfile name." fullword ascii
    $s5 = "[SERVER]connection to %s:%d error" fullword ascii
    $s6 = "[+] Make a Connection to %s:%d...." fullword ascii
    $s7 = "[+] Waiting another Client on port:%d...." fullword ascii
    $s8 = "[+] Accept a Client on port %d from %s" fullword ascii
    $s9 = "[+] Make a Connection to %s:%d ......" fullword ascii
    $s10 = "cmshared_get_ptr_from_atom" fullword ascii
    $s11 = "_cmshared_get_ptr_from_atom" fullword ascii
    $s12 = "[+] OK! I Closed The Two Socket." fullword ascii
    $s13 = "[-] TransmitPort invalid." fullword ascii
    $s14 = "[+] Waiting for Client on port:%d ......" fullword ascii
  condition:
    ( uint16(0) == 0x5a4d and filesize < 125KB and 3 of them ) 
    or 
    5 of them
}