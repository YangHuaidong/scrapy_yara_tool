import "pe"
rule ATM_Malware_DispenserXFS {
  meta:
    author = "Spider"
    comment = "None"
    date = "2019/02/27"
    description = "Detects ATM Malware DispenserXFS"
    family = "None"
    hacker = "None"
    judge = "black"
    reference = "https://twitter.com/r3c0nst/status/1100775857306652673"
    score = 80
    threatname = "None"
    threattype = "None"
  strings:
    $xc1 = { 68 ff ff 00 00 68 60 ea 00 00 6a 10 }
    $s1 = "\\dispenserXFS.pdb" ascii wide
    $s3 = "C:\\xfsasdf.txt" fullword ascii
    $s4 = "Injected mxsfs killer into %d." fullword ascii
    $s5 = "Waiting for freeze msxfs processes..." fullword ascii
  condition:
    uint16(0) == 0x5A4D and (
    1 of them or
    pe.imphash() == "617e037ae26d1931818db0790fb44bfe"
}