rule malware_sakula_shellcode {
  meta:
    author = "Spider"
    comment = "None"
    date = "None"
    description = "Sakula shellcode - taken from decoded setup.msi but may not be unique enough to identify Sakula"
    family = "None"
    hacker = "None"
    judge = "black"
    reference = "None"
    threatname = "None"
    threattype = "None"
  strings:
    55                      push    ebp
    89 E5                   mov     ebp, esp
    E8 00 00 00 00          call    $+5
    58                      pop     eax
    83 C0 06                add     eax, 6
    C9                      leave
    C3                      retn
    $opcodes01 = { 55 89 e5 e8 00 00 00 00 58 83 c0 06 c9 c3 }
    8B 5E 3C                mov     ebx, [esi+3Ch]  ; Offset to PE header
    8B 5C 1E 78             mov     ebx, [esi+ebx+78h] ; Length of headers
    8B 4C 1E 20             mov     ecx, [esi+ebx+20h] ; Number of data directories
    53                      push    ebx
    8B 5C 1E 24             mov     ebx, [esi+ebx+24h] ; Export table
    01 F3                   add     ebx, esi
    $opcodes02 = { 8b 5e 3c 8b 5c 1e 78 8b 4c 1e 20 53 8b 5c 1e 24 01 f3 }
  condition:
    any of them
}